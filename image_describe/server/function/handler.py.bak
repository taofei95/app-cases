import json
from modelscope.pipelines import pipeline
from modelscope.utils.constant import Tasks
from modelscope.outputs import OutputKeys

def handle(event, context):
    body = json.loads(event.body.decode('utf-8'))
    url = body["url"]
    
    print("debug:" + url + "\n")

    img_captioning = pipeline(Tasks.image_captioning, model='damo/ofa_image-caption_coco_distilled_en', model_revision='v1.0.1')
    result = img_captioning(url)

    return {
        "statusCode": 200,
        "body": result[OutputKeys.CAPTION]
    }
